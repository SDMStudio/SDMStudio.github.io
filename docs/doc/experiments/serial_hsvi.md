# HSVI for DecPOMDP (Serial vs Simultaneous)

<!-- # Solving DecPOMDP by serializing the problem  -->

<!-- ## Comparaison des méthodes dans le cas des NDPOMDP

### Test `example_4_3-1` (h=3)

1. **Simultané**

| Compress Precision | Num Trials | Error     | Value LB | Value UB | Size LB | Size UB | Num Occupancy States | Num Max JHist | Time     |
| ------------------ | ---------- | --------- | -------- | -------- | ------- | ------- | -------------------- | ------------- | -------- |
| 0,8                | 3          | 0         | 82,5703  | 82,5703  | 5       | 5       | 59                   | 1             | 0,214568 |
| 0,5                | 3          | 0         | 82,5703  | 82,5703  | 5       | 5       | 59                   | 2             | 0,219611 |
| 0,2                | 31         | 0,0164451 | 71,7526  | 71,7691  | 34      | 34      | 462                  | 16            | 2,02541  |
| 0,1                | 45         | 0         | 90,0107  | 90,0107  | 53      | 53      | 872                  | 16            | 4,65472  |

2. **Serializé**
   
| Compress Precision | Num Trials | Error     | Value LB | Value UB | Size LB | Size UB | Num Occupancy States | Num Max JHist | Time     |
| ------------------ | ---------- | --------- | -------- | -------- | ------- | ------- | -------------------- | ------------- | -------- |
| 0,8                | 11         | 0         | 82,5703  | 82,5703  | 47      | 47      | 92                   | 1             | 0,723477 |
| 0,5                | 11         | 0         | 82,5703  | 82,5703  | 47      | 47      | 92                   | 1             | 0,674701 |
| 0,2                | 128        | 0         | 74,2234  | 74,2234  | 255     | 255     | 608                  | 16            | 3,61137  |
| 0,1                | 135        | 0,0683282 | 93,1331  | 93,2015  | 335     | 335     | 1036                 | 16            | 5,77407  |


### Test `example_4_3-1` (h=4)

1. **Simultané**

| Compress Precision | Num Trials | Error     | Value LB | Value UB | Size LB | Size UB | Num Occupancy States | Num Max JHist | Time     |
| ------------------ | ---------- | --------- | -------- | -------- | ------- | ------- | -------------------- | ------------- | -------- |
| 0,8                | 9          | 0         | 94,2784  | 94,2784  | 15      | 15      | 159                  | 1             | 0,998006 |
| 0,5                | 9          | 0         | 94,2784  | 94,2784  | 15      | 15      | 159                  | 2             | 0,855829 |
| 0,2                | 84         | 0         | 90,344   | 90,344   | 105     | 105     | 2981                 | 16            | 12,5781  |
| 0,1                | 333        | 0,0815262 | 107,052  | 107,134  | 372     | 372     | 14878                | 16            | 143,688  |


2. **Serializé**

| Compress Precision | Num Trials | Error     | Value LB | Value UB | Size LB | Size UB | Num Occupancy States | Num Max JHist | Time    |
| ------------------ | ---------- | --------- | -------- | -------- | ------- | ------- | -------------------- | ------------- | ------- |
| 0,8                | 29         | 0         | 92,1091  | 92,1091  | 144     | 144     | 266                  | 1             | 3,14513 |
| 0,5                | 29         | 0         | 92,1091  | 92,1091  | 144     | 144     | 268                  | 2             | 3,23212 |
| 0,2                | 679        | 0,0711178 | 90,3887  | 90,4598  | 1267    | 1267    | 2785                 | 16            | 24,2494 |
| 0,1                | 2640       | 0,0971098 | 107,685  | 107,782  | 4494    | 4494    | 11936                | 16            | 106,901 |



# PROFILING

## ex4_3-1_3 simultané - precision_compress=0.10000
| NAME                           | TIME         (SIM)      | TIME (SER)              | PERCENT      (SIM)      | PERCENT (SER)           |
| ------------------------------ | ----------------------- | ----------------------- | ----------------------- | ----------------------- |
| TOTAL_TIME                     | 6.17751 s               | 9.68889 s               | 100.00000 %             | 100.00000 %             |
| ------------------------------ | ----------------------- | ----------------------- | ----------------------- | ----------------------- |
| HSVI::TIME_INITIALIZATION      | 1.56726 s               | 3.91987 s               | 25.37036 %              | 40.45741 %              |
| HSVI::TIME_IN_SELECT_ACTION    | 5.57790 s               | 8.79334 s               | 90.29374 %              | 90.75690 %              |
| HSVI::TIME_IN_SELECT_STATE     | 0.33109 s               | 0.77290 s               | 5.35952 %               | 7.97718 %               |
| HSVI::TIME_IN_UPDATE_LB        | 0.08524 s               | 0.03714 s               | 1.37988 %               | 0.38337 %               |
| HSVI::TIME_IN_UPDATE_UB        | 0.16083 s               | 0.04483 s               | 2.60348 %               | 0.46265 %               |
| ------------------------------ | ----------------------- | ----------------------- | ----------------------- | ----------------------- |
| OccMDP::TIME_IN_GET_ACTION     | 0.02198 s               | 0.00900 s               | 0.35579 %               | 0.09290 %               |
| OccMDP::TIME_IN_NEXT_STATE     | 2.57853 s               | 4.73542 s               | 41.74061 %              | 48.87475 %              |
| OccMDP::TIME_IN_COMPRESS       | 1.17490 s               | 0.71913 s               | 19.01903 %              | 7.42223 %               |
| OccMDP::TIME_IN_GET_REWARD     | 0.43373 s               | 0.01158 s               | 7.02108 %               | 0.11949 %               |
| ------------------------------ | ----------------------- | ----------------------- | ----------------------  | ----------------------  |

## ex4_3-1_3 simultané - precision_compress=0.10000
| NAME                           | TIME         (SIM)      | TIME (SER)              | PERCENT      (SIM)      | PERCENT (SER)           |
| ------------------------------ | ----------------------- | ----------------------- | ----------------------- | ----------------------- |
| TOTAL_TIME                     | 123.57658 s             | 139.99564 s             | 100.00000 %             | 100.00000 %             |
| ------------------------------ | ----------------------- | ----------------------- | ----------------------- | ----------------------- |
| HSVI::TIME_INITIALIZATION      | 7.09635 s               | 33.43435 s              | 5.74247 %               | 23.88242 %              |
| HSVI::TIME_IN_SELECT_ACTION    | 119.32598 s             | 134.36875 s             | 96.56035 %              | 95.98067 %              |
| HSVI::TIME_IN_SELECT_STATE     | 1.59573 s               | 3.81088 s               | 1.29129 %               | 2.72214 %               |
| HSVI::TIME_IN_UPDATE_LB        | 0.63555 s               | 0.56302 s               | 0.51430 %               | 0.40217 %               |
| HSVI::TIME_IN_UPDATE_UB        | 1.93841 s               | 0.75085 s               | 1.56859 %               | 0.53634 %               |
| ------------------------------ | ----------------------- | ----------------------- | ----------------------- | ----------------------- |
| OccMDP::TIME_IN_GET_ACTION     | 0.19648 s               | 0.23993 s               | 0.15899 %               | 0.17139 %               |
| OccMDP::TIME_IN_NEXT_STATE     | 68.74873 s              | 83.02711 s              | 55.63249 %              | 59.30693 %              |
| OccMDP::TIME_IN_COMPRESS       | 33.61491 s              | 14.11985 s              | 27.20168 %              | 10.08592 %              |
| OccMDP::TIME_IN_GET_REWARD     | 4.68786 s               | 0.35603 s               | 3.79348 %               | 0.25431 %               |
| ------------------------------ | ----------------------- | ----------------------- | ----------------------  | ----------------------  |



# Hierarchical HSVI

- UpperBound : Tabular / Exhaustive
- LowerBound : Tabular / Exhaustive

## TIGER (m=1)

| Horizon | Num Trials | Error | Value LB | Value UB | Size LB | Size UB | Num Occupancy States | Num Max JHist | Time        |
| ------- | ---------- | ----- | -------- | -------- | ------- | ------- | -------------------- | ------------- | ----------- |
| 1       | 1          | 0     | -2       | -2       | 1       | 1       | 2                    | 4             | 0,000366484 |
| 2       | 1          | 0     | 7,5      | 7,5      | 2       | 2       | 3                    | 4             | 0,0137729   |
| 3       | 1          | 0     | 14,4657  | 14,4657  | 3       | 3       | 15                   | 4             | 0,166905    |
| 4       | 2          | 0     | 22,2544  | 22,2544  | 6       | 6       | 31                   | 4             | 0,454124    |
| 5       | 5          | 0     | 21,9657  | 21,9657  | 10      | 10      | 79                   | 4             | 1,18284     |
| 6       | 2          | 0     | 37,243   | 37,243   | 7       | 7       | 58                   | 4             | 0,730977    |
| 7       | 3          | 0     | 36,5707  | 36,5707  | 12      | 12      | 58                   | 4             | 1,29451     |
| 8       | 23         | 0     | 45,1015  | 45,1015  | 37      | 37      | 338                  | 4             | 5,37453     |
| 9       | 7          | 0     | 52,1885  | 52,1885  | 20      | 20      | 168                  | 4             | 2,58219     |
| 10      | 14         | 0     | 60,1466  | 60,1466  | 26      | 26      | 225                  | 4             | 4,16277     |

## RECYCLING (m=1)

| Horizon | Num Trials | Error       | Value LB | Value UB | Size LB | Size UB | Num Occupancy States | Num Max JHist | Time        |
| ------- | ---------- | ----------- | -------- | -------- | ------- | ------- | -------------------- | ------------- | ----------- |
| 1       | 1          | 0           | 5        | 5        | 1       | 1       | 2                    | 4             | 0,000366961 |
| 2       | 2          | 0           | 7        | 7        | 3       | 3       | 12                   | 4             | 0,0270142   |
| 3       | 1          | 0           | 10,9312  | 10,9312  | 3       | 3       | 677                  | 4             | 0,148293    |
| 4       | 7          | 0           | 13,6501  | 13,6501  | 10      | 10      | 1957                 | 4             | 0,523285    |
| 5       | 18         | 0           | 16,9705  | 16,9705  | 39      | 39      | 14281                | 4             | 3,03435     |
| 6       | 101        | 2,54059E-05 | 19,8745  | 19,8746  | 149     | 149     | 5811                 | 4             | 15,4748     |
| 7       | 333        | 4,70235E-05 | 23,0273  | 23,0273  | 614     | 614     | 62815                | 4             | 87,604      |

## MABC (m=1)

| Horizon | Num Trials | Error | Value LB | Value UB | Size LB | Size UB | Num Occupancy States | Num Max JHist | Time        |
| ------- | ---------- | ----- | -------- | -------- | ------- | ------- | -------------------- | ------------- | ----------- |
| 1       | 1          | 0     | 1        | 1        | 1       | 1       | 2                    | 4             | 0,000312858 |
| 2       | 1          | 0     | 2        | 2        | 2       | 2       | 6                    | 4             | 0,00264484  |
| 3       | 1          | 0     | 2,99     | 2,99     | 3       | 3       | 27                   | 4             | 0,0172123   |
| 4       | 1          | 0     | 3,98     | 3,98     | 4       | 4       | 28                   | 4             | 0,0333387   |
| 5       | 1          | 0     | 4,899    | 4,899    | 5       | 5       | 36                   | 4             | 0,0493703   |
| 6       | 1          | 0     | 5,9699   | 5,96999  | 6       | 6       | 40                   | 4             | 0,0687399   |
| 7       | 1          | 0     | 6,95999  | 6,96     | 7       | 7       | 46                   | 4             | 0,0759973   |
| 8       | 1          | 0     | 7,95     | 7,95     | 8       | 8       | 46                   | 4             | 0,0869752   |
| 9       | 1          | 0     | 8,94     | 8,94     | 9       | 9       | 46                   | 4             | 0,0983599   |
| 10      | 1          | 0     | 9,93     | 9,93     | 10      | 10      | 46                   | 4             | 0,110252    | --> |


# Comparaison des méthodes

## mabc_100_1 

### PARAMS
 | MAX_TRIAL | MAX_TIME | Error | Horizon | p_o   | p_b  | p_c |
 | --------- | -------- | ----- | ------- | ----- | ---- | --- |
 | 34464     | 1800     | 0.01  | 100     | 0.001 | 0.01 | 0.1 |

### RESULTS
 |                         | Time    | Trials | Error      | LB Value | UB Value | Total Size LB | Total Size UB | Num Nodes (oState graph) | Num Nodes (belief graph) | Num Max of JHistory | Memory |
 | ----------------------- | ------- | ------ | ---------- | -------- | -------- | ------------- | ------------- | ------------------------ | ------------------------ | ------------------- | ------ |
 | SIM                     | 1.28028 | 3      | 0.00828585 | 90.738   | 90.7463  | 244           | 244           | 58                       | 118                      | 1                   | 8253   |
 | SER                     | 1.43325 | 15     | 0.00137701 | 90.7389  | 90.7403  | 814           | 814           | 127                      | 297                      | 1                   | 8269   |
 | SIM  (Maxplan/Sawtooth) | 1.3624  | 5      | 0.0074837  | 90.707   | 90.7145  | 167           | 163           | 62                       | 118                      | 1                   | 13544  |
 | SER (Maxplan/Sawtooth)  | 1.50633 | 21     | -0.329728  | 89.4216  | 89.0918  | 317           | 328           | 136                      | 297                      | 1                   | 13550  |
 

### RESULTS (do not store graph)
 |                        | Time    | Trials | Error      | LB Value | UB Value | Total Size LB | Total Size UB | Num Nodes (oState graph) | Num Nodes (belief graph) | Num Max of JHistory | Memory |
 | ---------------------- | ------- | ------ | ---------- | -------- | -------- | ------------- | ------------- | ------------------------ | ------------------------ | ------------------- | ------ |
 | SIM (Maxplan/Sawtooth) | 1.57218 | 3      | 0.00933716 | 90.7348  | 90.7442  | 114           | 115           | 1                        | 118                      | 0                   | 13380  |
 | SER (Maxplan/Sawtooth) | 2.22411 | 31     | 0.00686318 | 89.7545  | 89.7613  | 446           | 620           | 1                        | 297                      | 0                   | 12592  |

## recycling_10_1

### PARAMS
 | MAX_TRIAL | MAX_TIME | Error | Horizon | p_o | p_b | p_c |
 | --------- | -------- | ----- | ------- | --- | --- | --- |
 | 34464     | 1800     | 0.01  | 10      | 0.1 | 0.1 | 0.1 |

### RESULTS (store graph)
   |                        | Time    | Trials | Error      | LB Value | UB Value | Total Size LB | Total Size UB | Num Nodes (oState graph) | Num Nodes (belief graph) | Num Max of JHistory | Memory |
   | ---------------------- | ------- | ------ | ---------- | -------- | -------- | ------------- | ------------- | ------------------------ | ------------------------ | ------------------- | ------ |
   | SIM                    | 5.56031 | 203    | 0.00998992 | 31.4     | 31.41    | 283           | 283           | 123                      | 5                        | 4                   | 3813   |
   | SER                    | 2.34171 | 279    | 0.00362873 | 31.755   | 31.7586  | 647           | 647           | 553                      | 17                       | 4                   | 3461   |
   | SIM (Maxplan/Sawtooth) | 1.82763 | 19     | -0.0135327 | 31.8639  | 31.8504  | 21            | 35            | 102                      | 5                        | 4                   | 13709  |
   | SER (Maxplan/Sawtooth) | 481.489 | 34465  | 0.0396951  | 31.7455  | 31.7852  | 103           | 198           | 319                      | 17                       | 4                   | 13889  |
### RESULTS (do not store graph)
 |                        | Time    | Trials | Error       | LB Value | UB Value | Total Size LB | Total Size UB | Num Nodes (oState graph) | Num Nodes (belief graph) | Num Max of JHistory | Memory |
 | ---------------------- | ------- | ------ | ----------- | -------- | -------- | ------------- | ------------- | ------------------------ | ------------------------ | ------------------- | ------ |
 | SIM (Maxplan/Sawtooth) | 3.681   | 18     | 3.55271e-15 | 31.8639  | 31.8639  | 21            | 58            | 1                        | 5                        | 0                   | 12435  |
 | SER (Maxplan/Sawtooth) | 4.37389 | 75     | 3.55271e-15 | 31.8639  | 31.8639  | 112           | 664           | 1                        | 17                       | 0                   | 12464  |
## recycling_20_1

### PARAMS
 | MAX_TRIAL | MAX_TIME | Error | Horizon | p_o   | p_b  | p_c |
 | --------- | -------- | ----- | ------- | ----- | ---- | --- |
 | 34464     | 1800     | 0.01  | 20      | 0.001 | 0.01 | 0.1 |

### RESULTS
  |     | Time    | Trials | Error    | LB Value | UB Value | Total Size LB | Total Size UB | Num Nodes (oState graph) | Num Nodes (belief graph) | Num Max of JHistory | Memory |
  | --- | ------- | ------ | -------- | -------- | -------- | ------------- | ------------- | ------------------------ | ------------------------ | ------------------- | ------ |
  | SIM | 1072.45 | 14358  | 0.614851 | 62.6324  | 63.2473  | 40209         | 40209         | 18695                    | 5                        | 4                   | 15528  |
  | SER | 482.781 | 34465  | 0.614563 | 62.514   | 63.1286  | 145944        | 145944        | 470                      | 17                       | 4                   | 15528  |
  

## aligment_10_1
### PARAMS

 | MAX_TRIAL | MAX_TIME | Error | Horizon | p_o   | p_b  | p_c |
 | --------- | -------- | ----- | ------- | ----- | ---- | --- |
 | 34464     | 1800     | 0.01  | 10      | 0.001 | 0.01 | 0.1 |

### RESULTS

|                        | Time    | Trials | Error       | LB Value | UB Value | Total Size LB | Total Size UB | Num Nodes (oState graph) | Num Nodes (belief graph) | Num Max of JHistory | Memory |
| ---------------------- | ------- | ------ | ----------- | -------- | -------- | ------------- | ------------- | ------------------------ | ------------------------ | ------------------- | ------ |
| SIM                    | 111.246 | 2552   | 4.26326e-14 | 91       | 91       | 3798          | 3798          | 13379                    | 257                      | 2                   | 6752   |
| SER                    | 191.987 | 14298  | 0.00520833  | 91       | 91.0052  | 21576         | 21576         | 43993                    | 1272                     | 2                   | 7707   |
| SIM (Maxplan/Sawtooth) | 1802.03 | 940    | 50.682      | 91       | 141.682  | 798           | 3009          | 21354                    | 20214                    | 2                   | 14902  |
| SER (Maxplan/Sawtooth) | 1801.52 | 1229   | 51.4648     | 91       | 142.465  | 1734          | 8317          | 30898                    | 22579                    | 2                   | 15154  |


## Mars_5_1
### PARAMS

 | MAX_TRIAL | MAX_TIME | Error | Horizon | p_o | p_b | p_c |
 | --------- | -------- | ----- | ------- | --- | --- | --- |
 | 34464     | 1800     | 0.01  | 5       | 0.1 | 0.1 | 0.1 |

### RESULTS
   |                        | Time    | Trials | Error   | LB Value | UB Value | Total Size LB | Total Size UB | Num Nodes (oState graph) | Num Nodes (belief graph) | Num Max of JHistory | Memory |
   | ---------------------- | ------- | ------ | ------- | -------- | -------- | ------------- | ------------- | ------------------------ | ------------------------ | ------------------- | ------ |
   | SIM                    | 1801.67 | 0      | 69.3856 | -55      | 14.3856  | 0             | 0             | 1                        | 95                       | 0                   | 7047   |
   | SER                    | 1803.23 | 13     | 2.17971 | 11.8366  | 14.0163  | 51            | 51            | 1                        | 369                      | 0                   | 6544   |
   | SIM (Maxplan/Sawtooth) | 1801.45 | 32     | 1.97402 | 12.3755  | 14.3495  | 96            | 280           | 1                        | 760                      | 0                   | 13915  |
   | SER (Maxplan/Sawtooth) | 3481.49 | 0      | 69.3856 | -55      | 14.3856  | 5             | 0             | 1                        | 375                      | 0                   | 14163  |

## GridSmall_10_1
### PARAMS

 | MAX_TRIAL | MAX_TIME | Error | Horizon | p_o | p_b | p_c |
 | --------- | -------- | ----- | ------- | --- | --- | --- |
 | 34464     | 1800     | 0.01  | 10      | 0.1 | 0.1 | 0.1 |

### RESULTS

|                        | Time    | Trials | Error      | LB Value | UB Value | Total Size LB | Total Size UB | Num Nodes (oState graph) | Num Nodes (belief graph) | Num Max of JHistory | Memory |
| ---------------------- | ------- | ------ | ---------- | -------- | -------- | ------------- | ------------- | ------------------------ | ------------------------ | ------------------- | ------ |
| SIM                    | 78.5667 | 17     | -0.0892865 | 6.35295  | 6.26367  | 66            | 66            | 1                        | 629                      | 0                   | 7186   |
| SER                    | 6.6975  | 16     | -0.0781523 | 6.25727  | 6.17912  | 107           | 107           | 1                        | 3818                     | 0                   | 7176   |
| SIM (Maxplan/Sawtooth) | 1801.64 | 112    | 0.458392   | 5.80714  | 6.26553  | 96            | 666           | 1                        | 1287                     | 0                   | 14047  |
| SER (Maxplan/Sawtooth) | 1802.39 | 225    | 0.427174   | 5.76089  | 6.18807  | 401           | 2649          | 1                        | 4235                     | 0                   | 14115  |
## tiger_4_3

### PARAMS
 | MAX_TRIAL | MAX_TIME | Error | Horizon | p_o  | p_b  | p_c |
 | --------- | -------- | ----- | ------- | ---- | ---- | --- |
 | 34464     | 1800     | 0.01  | 4       | 0.01 | 0.01 | 0.1 |

### RESULTS

 
|                        | Time    | Trials | Error      | LB Value | UB Value | Total Size LB | Total Size UB | Num Nodes (oState graph) | Num Nodes (belief graph) | Num Max of JHistory | Memory |
| ---------------------- | ------- | ------ | ---------- | -------- | -------- | ------------- | ------------- | ------------------------ | ------------------------ | ------------------- | ------ |
| SIM                    | 1801.68 | 5      | 2.99098    | 4.02227  | 7.01325  | 8             | 8             | 1                        | 5                        | 0                   | 8304   |
| SER                    | 422.387 | 136    | 0.00454273 | 4.02227  | 4.02681  | 173           | 173           | 1                        | 20                       | 0                   | 7967   |
| SIM (Maxplan/Sawtooth) | 1998.33 | 4      | 3.49731    | 3.51594  | 7.01325  | 10            | 13            | 1                        | 101                      | 0                   | 14666  |
| SER (Maxplan/Sawtooth) | 1801.68 | 1090   | 0.0891938  | 3.51594  | 3.60513  | 188           | 5516          | 1                        | 194                      | 0                   | 14985  |

## boxPushing_4_1 
### PARAMS
 | MAX_TRIAL | MAX_TIME | Error | Horizon | p_o | p_b  | p_c |
 | --------- | -------- | ----- | ------- | --- | ---- | --- |
 | 34464     | 1800     | 0.01  | 4       | 0.1 | 0.01 | 0.1 |

### RESULTS

 |                        | Time    | Trials | Error    | LB Value | UB Value | Total Size LB | Total Size UB | Num Nodes (oState graph) | Num Nodes (belief graph) | Num Max of JHistory | Memory |
 | ---------------------- | ------- | ------ | -------- | -------- | -------- | ------------- | ------------- | ------------------------ | ------------------------ | ------------------- | ------ |
 | SIM                    | 1801.68 | 3      | 0.250605 | 97.7405  | 97.9911  | 7             | 7             | 1                        | 179                      | 0                   | 7387   |
 | SER                    | 52.832  | 14     | 0        | 96.4869  | 96.4869  | 23            | 23            | 1                        | 309                      | 0                   | 8303   |
 | SIM (Maxplan/Sawtooth) | 2660.94 | 10     | 0.109513 | 98.1692  | 98.2787  | 11            | 29            | 1                        | 4124                     | 0                   | 14896  |
 | SER (Maxplan/Sawtooth) | 1807.42 | 290    | 0.01584  | 98.1692  | 98.185   | 239           | 1992          | 1                        | 3682                     | 0                   | 14876  |